<html>
  <head> <!--this is metadata -->
    <title>Test</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="jquery-2.1.1.min.js"></script> 
	
    <style>
	 html, body {
            height: 100%;
            margin: 0;
            font-family: Calibri, sans-serif;
        }

      header {
            /*position: fixed; /* Keep the header fixed at the top */
            top: 0;
            left: 0;
            width: 100%; /* Full width */
            background-color: yellow; /* Background color */
            padding: 10px; /* Space inside the header */
            box-sizing: border-box;
            z-index: 1000; /* Ensure it stays above other content */
        }

        body {
            /*padding-top: 100px;  Offset body content by header height */
            display: flex;
		flex-direction: column;
            justify-content: center;
            align-items: center;
        }
	    
	#top-div {
            width: 1000px;
            height: 550px;
            background-color: white;
	}   
	    #map {
            width: 1000px;
            height: 550px;
            background-color: #eee; /* Background color for visibility */
        }	
	    #bottom-div {
            width: 1000px;
            height: 250px;
            background-color: yellow;
	}	
        h1 {
            color: black;
            font-family: Brush Script MT, sans-serif;
            font-size: 400%;
            text-align: center;
            margin: 0;
        }
	    
	h2 {
            color: black;
            font-family: Brush Script MT, sans-serif;
            font-size: 250%;
            text-align: center;
            margin: 0;
        }
	p {
            color: black;
            font-family: Brush Script MT, sans-serif;
	}
	
 /* Custom popup style on the right side inside the map frame */
        .leaflet-right-popup {
            position: absolute;
	    max-width: 500px;
            right: 0;
            top: 10px;
            width: 300px;
            background: yellow;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            z-index: 1000;
        }
/* Button styling */
        .reset-button {
            align: center;
            padding: 20px;
	    background-color: black;
            color: white;
            padding: 10px;
            border: none;
            cursor: pointer;
            text-align: center;
            border-radius: 5px;
        }
  }


    </style>
  </head>
 
  <body>
    <header>
      <h1>üêù</h1>
    </header>
    <!-- The map container -->
    <div id="top-div">
	    <div id="map"></div>
    </div>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.fullscreen/1.6.0/Control.FullScreen.css" />
	<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.fullscreen/1.6.0/Control.FullScreen.js"></script>
	</div>
    <script>
  // Initialize the map and set its view to the center of Europe with an appropriate zoom level
  var map = L.map('map').setView([48.1657, 9.9515], 5);
	
  
  //Add the OpenStreetMap tile layer
L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
    attribution: '&copy; <a href="https://carto.com/attributions">CARTO</a>',
	maxZoom: 12,
      	minZoom: 5
}).addTo(map);

// Add fullscreen control to the map
L.control.fullscreen().addTo(map);

// Handle events when entering/exiting fullscreen mode (optional)
map.on('enterFullscreen', function(){
    console.log('Entered fullscreen');
});

map.on('exitFullscreen', function(){
    console.log('Exited fullscreen');
});	    

//L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
//attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
  //}).addTo(map);
  
  // Load GeoJSON from an external file and add GeoJSON layer to the map once the file is loaded
// load GeoJSON from an external file
 // Define a custom icon (optional)
// Define a custom icon (optional)
// Define custom icons
        // Marker icons
        var DefaultMarkerIcon = L.icon({
          iconUrl: 'beeIconMod.png',
          iconSize: [50, 50]
        });

        var HoverMarkerIcon = L.icon({
          iconUrl: 'beeIconMod.png',
          iconSize: [75, 75]
        });

        var PopupMarkerIcon = L.icon({
          iconUrl: 'BuzzBee40.gif',
          iconSize: [80, 75]
        });
	    
 // Global variable to keep track of the last clicked marker
        var lastClickedMarker = null;
	    
  	var DefaultPopupContent = '<h2>Du hast hummeln in hintern</h2><p>Click on a bee to see pictures of my travel</p>';
	// Function to set the default content of the right-hand popup and reset the marker icon
	    
        // Create a custom control for the right-hand side popup
        var rightSidePopup = L.Control.extend({
            onAdd: function(map) {
                var div = L.DomUtil.create('div', 'leaflet-right-popup');
                // Set default content initially
                div.innerHTML = DefaultPopupContent;
                return div;
            }
        });

        // Add the control to the map
        var rightPopupControl = new rightSidePopup({ position: 'topright' });
        map.addControl(rightPopupControl);

        // Variable to hold the reference to the control's div for updating content
        var rightPopupDiv = document.querySelector('.leaflet-right-popup');

    
	function setDefaultPopupContent() {
   	 rightPopupDiv.innerHTML = DefaultPopupContent;

    // Reset the last clicked marker icon to the default if it exists
    if (lastClickedMarker) {
        lastClickedMarker.setIcon(DefaultMarkerIcon);
        lastClickedMarker = null;  // Clear the lastClickedMarker after resetting
    }
}

        // Function to update the custom right-hand popup content with a reset button
        function updateRightPopup(properties, latlng) {
            rightPopupDiv.innerHTML = '<h2>' + properties.name + '</h2>' +
                                      '<img src="fotos/' + properties.fotoID + '" style="width: 100%; height: auto;">' +
                                      '<button class="reset-button" onclick="setDefaultPopupContent()">Buzz off</button>';
        }

        // GeoJSON data (can be replaced with your actual GeoJSON)
        var geoJsonData = {
            "type": "FeatureCollection",
            "features": [
                {
                    "type": "Feature",
                    "geometry": {
                        "type": "Point",
                        "coordinates": [-0.09, 51.5]
                    },
                    "properties": {
                        "name": "Marker 1",
                        "fotoID": "image1.jpg"
                    }
                }
                // Add more GeoJSON features here
            ]
        };

        // Function to add the GeoJSON layer to the map
        function addGeoJsonLayer() {
            geoJsonLayer = L.geoJSON(geoJsonData, {
                pointToLayer: function(feature, latlng) {
                    var marker = L.marker(latlng, { icon: DefaultMarkerIcon });

                    var HoverContent = feature.properties.name;

                    // Bind tooltip (shown on hover)
                    marker.bindTooltip(HoverContent, {
                        offset: [0, -30],
                        permanent: false,
                        direction: 'top',
                        className: 'custom-tooltip'
                    });

                    // Event listener for marker click (updates right-hand popup and changes icon)
                    marker.on('click', function() {
                        // Reset the last clicked marker to default icon if it exists and isn't this marker
                        if (lastClickedMarker && lastClickedMarker !== marker) {
                            lastClickedMarker.setIcon(DefaultMarkerIcon);
                        }

                        // Set this marker as the last clicked marker
                        lastClickedMarker = marker;

                        // Change the icon to the popup marker icon
                        this.setIcon(PopupMarkerIcon);

                        // Update the right-side popup with this marker's information
                        updateRightPopup(feature.properties, latlng);
                    });

                    // Hover behavior
                    marker.on('mouseover', function() {
                        if (!this.isPopupOpen() && this !== lastClickedMarker) {
                            this.setIcon(HoverMarkerIcon);
                            this.openTooltip();
                        }
                    });

                    marker.on('mouseout', function() {
                        if (!this.isPopupOpen() && this !== lastClickedMarker) {
                            this.setIcon(DefaultMarkerIcon);
                            this.closeTooltip();
                        }
                    });

                    return marker;
                }
            }).addTo(map);
        }

        // Add the GeoJSON layer to the map
        addGeoJsonLayer();

        // Set the default content when the map is initialized
        setDefaultPopupContent();
	    
// Function to update layer visibility based on zoom level
function updateLayerVisibility() {
  var zoom = map.getZoom();
  
  if (zoom < 7 && geoJsonLayer) {
    // Remove the layer if the zoom level is less than 7
    map.removeLayer(geoJsonLayer);
    geoJsonLayer = null;
  } else if (zoom >= 7 && !geoJsonLayer) {
    // Re-add the layer if the zoom level is 7 or higher and the layer doesn't exist
    addGeoJsonLayer();
  }
}

// Fetch GeoJSON data and store it globally
$.getJSON("orte.geojson", function(loadedData) {
  geoJsonData = loadedData; // Store the data globally

  // Initialize visibility based on the initial zoom level
  updateLayerVisibility();
});

// Update layer visibility on zoom end
map.on('zoomend', updateLayerVisibility);
	    
</script>
<div id="bottom-div">
	  
	<h2><br>This is still a test</h2>
	  
	<p>test, buzz buzz </p>
</div>  	  
  </body>
</html>
